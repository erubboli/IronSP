<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Tilt::Template</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Tilt::Template</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/tilt/template_rb.html">
                lib/tilt/template.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Base class for template implementations. Subclasses must implement the <a
href="Template.html#M000118">prepare</a> method and one of the <a
href="Template.html#M000119">evaluate</a> or <a
href="Template.html#M000123">precompiled_template</a> methods.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000113">basename</a>&nbsp;&nbsp;
      <a href="#M000120">cached_evaluate</a>&nbsp;&nbsp;
      <a href="#M000121">cached_evaluate</a>&nbsp;&nbsp;
      <a href="#M000126">compiled_method</a>&nbsp;&nbsp;
      <a href="#M000115">eval_file</a>&nbsp;&nbsp;
      <a href="#M000119">evaluate</a>&nbsp;&nbsp;
      <a href="#M000116">initialize_engine</a>&nbsp;&nbsp;
      <a href="#M000114">name</a>&nbsp;&nbsp;
      <a href="#M000111">new</a>&nbsp;&nbsp;
      <a href="#M000122">precompiled</a>&nbsp;&nbsp;
      <a href="#M000125">precompiled_postamble</a>&nbsp;&nbsp;
      <a href="#M000124">precompiled_preamble</a>&nbsp;&nbsp;
      <a href="#M000123">precompiled_template</a>&nbsp;&nbsp;
      <a href="#M000118">prepare</a>&nbsp;&nbsp;
      <a href="#M000112">render</a>&nbsp;&nbsp;
      <a href="#M000117">require_template_library</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">



    <div id="aliases-list">
      <h3 class="section-bar">External Aliases</h3>

      <div class="name-list">
                        <table summary="aliases">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">engine_initialized</td>
          <td>-&gt;</td>
          <td class="context-item-value">engine_initialized?</td>
        </tr>
                        </table>
      </div>
    </div>


    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">data</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
<a href="Template.html">Template</a> source; loaded from a file or given
directly.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">default_mime_type</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">engine_initialized</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">file</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The <a href="Template.html#M000114">name</a> of the file where the template
data was loaded from.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">line</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The line number in file where template data was loaded from.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">options</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
A Hash of template engine specific options. This is passed directly to the
underlying engine and is not used by the generic template interface.

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000111" class="method-detail">
        <a name="M000111"></a>

        <div class="method-heading">
          <a href="#M000111" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(file=nil, line=1, options={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create a <a href="Template.html#M000111">new</a> template with the file,
line, and options specified. By default, template data is read from the
file. When a block is given, it should read template data and return as a
String. When file is nil, a block is required.
</p>
<p>
All arguments are optional.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000111-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000111-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 38</span>
38:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">file</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">line</span>=<span class="ruby-value">1</span>, <span class="ruby-identifier">options</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
39:       <span class="ruby-ivar">@file</span>, <span class="ruby-ivar">@line</span>, <span class="ruby-ivar">@options</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">1</span>, {}
40: 
41:       [<span class="ruby-identifier">options</span>, <span class="ruby-identifier">line</span>, <span class="ruby-identifier">file</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
42:         <span class="ruby-keyword kw">case</span>
43:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:to_str</span>)  ; <span class="ruby-ivar">@file</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_str</span>
44:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:to_int</span>)  ; <span class="ruby-ivar">@line</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_int</span>
45:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:to_hash</span>) ; <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_hash</span>.<span class="ruby-identifier">dup</span>
46:         <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>
47:         <span class="ruby-keyword kw">end</span>
48:       <span class="ruby-keyword kw">end</span>
49: 
50:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;file or block required&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@file</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span>).<span class="ruby-identifier">nil?</span>
51: 
52:       <span class="ruby-comment cmt"># call the initialize_engine method if this is the very first time</span>
53:       <span class="ruby-comment cmt"># an instance of this class has been created.</span>
54:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">engine_initialized?</span>
55:         <span class="ruby-identifier">initialize_engine</span>
56:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">engine_initialized</span> = <span class="ruby-keyword kw">true</span>
57:       <span class="ruby-keyword kw">end</span>
58: 
59:       <span class="ruby-comment cmt"># used to hold compiled template methods</span>
60:       <span class="ruby-ivar">@compiled_method</span> = {}
61: 
62:       <span class="ruby-comment cmt"># used on 1.9 to set the encoding if it is not set elsewhere (like a magic comment)</span>
63:       <span class="ruby-comment cmt"># currently only used if template compiles to ruby</span>
64:       <span class="ruby-ivar">@default_encoding</span> = <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">:default_encoding</span>
65: 
66:       <span class="ruby-comment cmt"># load template data and prepare (uses binread to avoid encoding issues)</span>
67:       <span class="ruby-ivar">@reader</span> = <span class="ruby-identifier">block</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:binread</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-ivar">@file</span>) <span class="ruby-operator">:</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-ivar">@file</span>) }
68:       <span class="ruby-ivar">@data</span> = <span class="ruby-ivar">@reader</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">self</span>)
69:       <span class="ruby-identifier">prepare</span>
70:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Class methods</h3>

      <div id="method-M000121" class="method-detail">
        <a name="M000121"></a>

        <div class="method-heading">
          <a href="#M000121" class="method-signature">
          <span class="method-name">cached_evaluate</span><span class="method-args">(scope, locals, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Redefine itself to use method compilation the next time:
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000121-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000121-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 138</span>
138:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
139:         <span class="ruby-identifier">method</span> = <span class="ruby-identifier">compiled_method</span>(<span class="ruby-identifier">locals</span>.<span class="ruby-identifier">keys</span>)
140:         <span class="ruby-identifier">method</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-identifier">scope</span>).<span class="ruby-identifier">call</span>(<span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
141:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000113" class="method-detail">
        <a name="M000113"></a>

        <div class="method-heading">
          <a href="#M000113" class="method-signature">
          <span class="method-name">basename</span><span class="method-args">(suffix='')</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The <a href="Template.html#M000113">basename</a> of the template file.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000113-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000113-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 80</span>
80:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">basename</span>(<span class="ruby-identifier">suffix</span>=<span class="ruby-value str">''</span>)
81:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">suffix</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>
82:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000115" class="method-detail">
        <a name="M000115"></a>

        <div class="method-heading">
          <a href="#M000115" class="method-signature">
          <span class="method-name">eval_file</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The filename used in backtraces to describe the template.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000115-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000115-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 90</span>
90:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">eval_file</span>
91:       <span class="ruby-identifier">file</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'(__TEMPLATE__)'</span>
92:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000114" class="method-detail">
        <a name="M000114"></a>

        <div class="method-heading">
          <a href="#M000114" class="method-signature">
          <span class="method-name">name</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The template file&#8216;s <a href="Template.html#M000113">basename</a> with
all extensions chomped off.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000114-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000114-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 85</span>
85:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">name</span>
86:       <span class="ruby-identifier">basename</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'.'</span>, <span class="ruby-value">2</span>).<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">basename</span>
87:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000112" class="method-detail">
        <a name="M000112"></a>

        <div class="method-heading">
          <a href="#M000112" class="method-signature">
          <span class="method-name">render</span><span class="method-args">(scope=Object.new, locals={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Render the template in the given scope with the locals specified. If a
block is given, it is typically available within the template via
<tt>yield</tt>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000112-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000112-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 75</span>
75:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render</span>(<span class="ruby-identifier">scope</span>=<span class="ruby-constant">Object</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">locals</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
76:       <span class="ruby-identifier">evaluate</span> <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span> <span class="ruby-operator">||</span> {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
77:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000120" class="method-detail">
        <a name="M000120"></a>

        <div class="method-heading">
          <a href="#M000120" class="method-signature">
          <span class="method-name">cached_evaluate</span><span class="method-args">(scope, locals, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Process the template and return the result. The first time this method is
called, the template source is evaluated with instance_eval. On the
sequential method calls it will compile the template to an unbound method
which will lead to better performance. In any case, template executation is
guaranteed to be performed in the scope object with the locals specified
and with support for yielding to the block.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000120-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000120-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 136</span>
136:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
137:       <span class="ruby-comment cmt"># Redefine itself to use method compilation the next time:</span>
138:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
139:         <span class="ruby-identifier">method</span> = <span class="ruby-identifier">compiled_method</span>(<span class="ruby-identifier">locals</span>.<span class="ruby-identifier">keys</span>)
140:         <span class="ruby-identifier">method</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-identifier">scope</span>).<span class="ruby-identifier">call</span>(<span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
141:       <span class="ruby-keyword kw">end</span>
142: 
143:       <span class="ruby-comment cmt"># Use instance_eval the first time:</span>
144:       <span class="ruby-identifier">evaluate_source</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
145:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000126" class="method-detail">
        <a name="M000126"></a>

        <div class="method-heading">
          <a href="#M000126" class="method-signature">
          <span class="method-name">compiled_method</span><span class="method-args">(locals_keys)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The compiled method for the locals keys provided.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000126-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000126-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 200</span>
200:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compiled_method</span>(<span class="ruby-identifier">locals_keys</span>)
201:       <span class="ruby-ivar">@compiled_method</span>[<span class="ruby-identifier">locals_keys</span>] <span class="ruby-operator">||=</span>
202:         <span class="ruby-identifier">compile_template_method</span>(<span class="ruby-identifier">locals_keys</span>)
203:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000119" class="method-detail">
        <a name="M000119"></a>

        <div class="method-heading">
          <a href="#M000119" class="method-signature">
          <span class="method-name">evaluate</span><span class="method-args">(scope, locals, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000119-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000119-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 126</span>
126:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
127:       <span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
128:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000116" class="method-detail">
        <a name="M000116"></a>

        <div class="method-heading">
          <a href="#M000116" class="method-signature">
          <span class="method-name">initialize_engine</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Called once and only once for each template subclass the first time the
template class is initialized. This should be used to require the
underlying template library and perform any initial setup.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000116-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000116-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 98</span>
98:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize_engine</span>
99:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000122" class="method-detail">
        <a name="M000122"></a>

        <div class="method-heading">
          <a href="#M000122" class="method-signature">
          <span class="method-name">precompiled</span><span class="method-args">(locals)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Generates all template source by combining the preamble, template, and
postamble and returns a two-tuple of the form: [source, offset], where
source is the string containing (Ruby) source code for the template and
offset is the integer line offset where line reporting should begin.
</p>
<p>
<a href="Template.html">Template</a> subclasses may override this method
when they need complete control over source generation or want to adjust
the default line offset. In most cases, overriding the <a
href="Template.html#M000123">precompiled_template</a> method is easier and
more appropriate.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000122-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000122-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 156</span>
156:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled</span>(<span class="ruby-identifier">locals</span>)
157:       <span class="ruby-identifier">preamble</span> = <span class="ruby-identifier">precompiled_preamble</span>(<span class="ruby-identifier">locals</span>)
158:       <span class="ruby-identifier">template</span> = <span class="ruby-identifier">precompiled_template</span>(<span class="ruby-identifier">locals</span>)
159:       <span class="ruby-identifier">magic_comment</span> = <span class="ruby-identifier">extract_magic_comment</span>(<span class="ruby-identifier">template</span>)
160:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">magic_comment</span>
161:         <span class="ruby-comment cmt"># Magic comment e.g. &quot;# coding: utf-8&quot; has to be in the first line.</span>
162:         <span class="ruby-comment cmt"># So we copy the magic comment to the first line.</span>
163:         <span class="ruby-identifier">preamble</span> = <span class="ruby-identifier">magic_comment</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">preamble</span>
164:       <span class="ruby-keyword kw">end</span>
165:       <span class="ruby-identifier">parts</span> = [
166:         <span class="ruby-identifier">preamble</span>,
167:         <span class="ruby-identifier">template</span>,
168:         <span class="ruby-identifier">precompiled_postamble</span>(<span class="ruby-identifier">locals</span>)
169:       ]
170:       [<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>), <span class="ruby-identifier">preamble</span>.<span class="ruby-identifier">count</span>(<span class="ruby-value str">&quot;\n&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-value">1</span>]
171:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000125" class="method-detail">
        <a name="M000125"></a>

        <div class="method-heading">
          <a href="#M000125" class="method-signature">
          <span class="method-name">precompiled_postamble</span><span class="method-args">(locals)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Generates postamble code for the <a
href="Template.html#M000122">precompiled</a> template source. The string
returned from this method is appended to the <a
href="Template.html#M000122">precompiled</a> template source.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000125-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000125-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 195</span>
195:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled_postamble</span>(<span class="ruby-identifier">locals</span>)
196:       <span class="ruby-value str">''</span>
197:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000124" class="method-detail">
        <a name="M000124"></a>

        <div class="method-heading">
          <a href="#M000124" class="method-signature">
          <span class="method-name">precompiled_preamble</span><span class="method-args">(locals)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Generates preamble code for initializing template state, and performing
locals assignment. The default implementation performs locals assignment
only. Lines included in the preamble are subtracted from the source line
offset, so adding code to the preamble does not effect line reporting in
Kernel::caller and backtraces.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000124-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000124-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 188</span>
188:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled_preamble</span>(<span class="ruby-identifier">locals</span>)
189:       <span class="ruby-identifier">locals</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{k} = locals[#{k.inspect}]&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
190:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000123" class="method-detail">
        <a name="M000123"></a>

        <div class="method-heading">
          <a href="#M000123" class="method-signature">
          <span class="method-name">precompiled_template</span><span class="method-args">(locals)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
A string containing the (Ruby) source code for the template. The default <a
href="Template.html#M000119">Template#evaluate</a> implementation requires
either this method or the <a href="Template.html#M000122">precompiled</a>
method be overridden. When defined, the base <a
href="Template.html">Template</a> guarantees correct file/line handling,
locals support, custom scopes, and support for template compilation when
the scope object allows it.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000123-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000123-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 179</span>
179:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled_template</span>(<span class="ruby-identifier">locals</span>)
180:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>
181:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000118" class="method-detail">
        <a name="M000118"></a>

        <div class="method-heading">
          <a href="#M000118" class="method-signature">
          <span class="method-name">prepare</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Do whatever preparation is necessary to setup the underlying template
engine. Called immediately after template data is loaded. Instance
variables set in this method are available when <a
href="Template.html#M000119">evaluate</a> is called.
</p>
<p>
Subclasses must provide an implementation of this method.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000118-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000118-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 116</span>
116:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare</span>
117:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:compile!</span>)
118:         <span class="ruby-comment cmt"># backward compat with tilt &lt; 0.6; just in case</span>
119:         <span class="ruby-identifier">warn</span> <span class="ruby-value str">'Tilt::Template#compile! is deprecated; implement #prepare instead.'</span>
120:         <span class="ruby-identifier">compile!</span>
121:       <span class="ruby-keyword kw">else</span>
122:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>
123:       <span class="ruby-keyword kw">end</span>
124:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000117" class="method-detail">
        <a name="M000117"></a>

        <div class="method-heading">
          <a href="#M000117" class="method-signature">
          <span class="method-name">require_template_library</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Like Kernel::require but issues a warning urging a manual require when
running under a threaded environment.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000117-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000117-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 103</span>
103:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">require_template_library</span>(<span class="ruby-identifier">name</span>)
104:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">list</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
105:         <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;WARN: tilt autoloading '#{name}' in a non thread-safe way; &quot;</span> <span class="ruby-operator">+</span>
106:              <span class="ruby-node">&quot;explicit require '#{name}' suggested.&quot;</span>
107:       <span class="ruby-keyword kw">end</span>
108:       <span class="ruby-identifier">require</span> <span class="ruby-identifier">name</span>
109:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>