<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>parse_line_indicators (Slim::Parser)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File lib/slim/parser.rb, line 212</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_line_indicators</span>
      <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@line</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\A\/!( ?)/</span>
        <span class="ruby-comment cmt"># HTML comment</span>
        <span class="ruby-ivar">@stacks</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:html</span>, <span class="ruby-identifier">:comment</span>, [<span class="ruby-identifier">:slim</span>, <span class="ruby-identifier">:text</span>, <span class="ruby-identifier">parse_text_block</span>(<span class="ruby-identifier">$'</span>, <span class="ruby-ivar">@indents</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>)]]
      <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\A\/\[\s*(.*?)\s*\]\s*\Z/</span>
        <span class="ruby-comment cmt"># HTML conditional comment</span>
        <span class="ruby-identifier">block</span> = [<span class="ruby-identifier">:multi</span>]
        <span class="ruby-ivar">@stacks</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:html</span>, <span class="ruby-identifier">:condcomment</span>, <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">block</span>]
        <span class="ruby-ivar">@stacks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">block</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\A\//</span>
        <span class="ruby-comment cmt"># Slim comment</span>
        <span class="ruby-identifier">parse_comment_block</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\A([\|'])( ?)/</span>
        <span class="ruby-comment cmt"># Found a text block.</span>
        <span class="ruby-identifier">trailing_ws</span> = <span class="ruby-identifier">$1</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;'&quot;</span>
        <span class="ruby-ivar">@stacks</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:slim</span>, <span class="ruby-identifier">:text</span>, <span class="ruby-identifier">parse_text_block</span>(<span class="ruby-identifier">$'</span>, <span class="ruby-ivar">@indents</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)]
        <span class="ruby-ivar">@stacks</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:static</span>, <span class="ruby-value str">' '</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">trailing_ws</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\A&lt;/</span>
        <span class="ruby-comment cmt"># Inline html</span>
        <span class="ruby-comment cmt"># @stacks.last &lt;&lt; parse_text_block(@line, @indents.last + 1)</span>
        <span class="ruby-identifier">block</span> = [<span class="ruby-identifier">:multi</span>]
        <span class="ruby-ivar">@stacks</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:multi</span>, [<span class="ruby-identifier">:slim</span>, <span class="ruby-identifier">:interpolate</span>, <span class="ruby-ivar">@line</span>], <span class="ruby-identifier">block</span>]
        <span class="ruby-ivar">@stacks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">block</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\A-/</span>
        <span class="ruby-comment cmt"># Found a code block.</span>
        <span class="ruby-comment cmt"># We expect the line to be broken or the next line to be indented.</span>
        <span class="ruby-ivar">@line</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">0</span>)
        <span class="ruby-identifier">block</span> = [<span class="ruby-identifier">:multi</span>]
        <span class="ruby-ivar">@stacks</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:slim</span>, <span class="ruby-identifier">:control</span>, <span class="ruby-identifier">parse_broken_line</span>, <span class="ruby-identifier">block</span>]
        <span class="ruby-ivar">@stacks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">block</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\A=/</span>
        <span class="ruby-comment cmt"># Found an output block.</span>
        <span class="ruby-comment cmt"># We expect the line to be broken or the next line to be indented.</span>
        <span class="ruby-ivar">@line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\A=(=?)('?)/</span>
        <span class="ruby-ivar">@line</span> = <span class="ruby-identifier">$'</span>
        <span class="ruby-identifier">block</span> = [<span class="ruby-identifier">:multi</span>]
        <span class="ruby-ivar">@stacks</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:slim</span>, <span class="ruby-identifier">:output</span>, <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">empty?</span>, <span class="ruby-identifier">parse_broken_line</span>, <span class="ruby-identifier">block</span>]
        <span class="ruby-ivar">@stacks</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:static</span>, <span class="ruby-value str">' '</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-ivar">@stacks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">block</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\A(\w+):\s*\Z/</span>
        <span class="ruby-comment cmt"># Embedded template detected. It is treated as block.</span>
        <span class="ruby-ivar">@stacks</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:slim</span>, <span class="ruby-identifier">:embedded</span>, <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">parse_text_block</span>]
      <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/\Adoctype\s+/i</span>
        <span class="ruby-comment cmt"># Found doctype declaration</span>
        <span class="ruby-ivar">@stacks</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:html</span>, <span class="ruby-identifier">:doctype</span>, <span class="ruby-identifier">$'</span>.<span class="ruby-identifier">strip</span>]
      <span class="ruby-keyword kw">when</span> <span class="ruby-ivar">@tag_regex</span>
        <span class="ruby-comment cmt"># Found a HTML tag.</span>
        <span class="ruby-ivar">@line</span> = <span class="ruby-identifier">$'</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$1</span>
        <span class="ruby-identifier">parse_tag</span>(<span class="ruby-identifier">$&amp;</span>)
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-identifier">syntax_error!</span> <span class="ruby-value str">'Unknown line indicator'</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-ivar">@stacks</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">:newline</span>]
    <span class="ruby-keyword kw">end</span></pre>
</body>
</html>